<div class="max-w-[98vw] mx-auto bg-white rounded-xl shadow-[0_10px_40px_rgba(0,0,0,0.3)] p-3">
  @if (activeTab() !== 'preview') {
    <app-progress-bar
      [progress]="stepMappingService.progress()"
      [text]="stepMappingService.progressText()"
    />

    <div class="flex gap-3 mb-3">
      <!-- Wybrane pakiety - lewa strona 50% -->
      <div class="w-1/2">
        <app-selected-packages
          [text]="stepMappingService.selectedPackagesText()"
          [parts]="selectedPartsList()"
          [selectedPackages]="stepMappingService.selectedPackages()"
          (partClick)="onPartClick($event)"
        />
      </div>

      <!-- Poprzedni krok - prawa strona 50% -->
      <div class="w-1/2">
        @if (previousStepPartsList().length > 0) {
          <div class="bg-gradient-to-r from-blue-400 to-indigo-400 text-white p-2.5 rounded-lg h-full">
            <h3 class="mb-1.5 font-semibold text-sm text-right">
              ğŸ“‹ Poprzedni krok ({{ stepMappingService.currentStep() - 1 }})
            </h3>
            <div class="grid grid-cols-[repeat(auto-fill,minmax(75px,1fr))] gap-1.5 mt-2 opacity-90">
              @for (part of previousStepPartsList(); track part.pkg) {
                <app-part-item [part]="part" [isSelected]="false" />
              }
            </div>
          </div>
        }
      </div>
    </div>

    <app-controls
      [currentStep]="stepMappingService.currentStep()"
      (nextStep)="onNextStep()"
      (previousStep)="onPreviousStep()"
      (download)="onDownload()"
      (clearCurrent)="onClearCurrent()"
    />
  }

  <!-- ZakÅ‚adki i wyszukiwarka -->
  <div class="flex gap-3 mb-3 items-center justify-between">
    <div class="flex gap-2">
      <button
        (click)="setActiveTab('parts')"
        [class]="activeTab() === 'parts' ? 'bg-[#667eea] text-white' : 'bg-gray-200 text-gray-700'"
        class="px-4 py-2 rounded-lg font-semibold text-sm transition-colors hover:opacity-90"
      >
        ğŸ“¦ Lista wszystkich czÄ™Å›ci
      </button>
      <button
        (click)="setActiveTab('history')"
        [class]="
          activeTab() === 'history' ? 'bg-[#667eea] text-white' : 'bg-gray-200 text-gray-700'
        "
        class="px-4 py-2 rounded-lg font-semibold text-sm transition-colors hover:opacity-90"
      >
        âœ… Zmapowane kroki ({{ stepMappingService.mappedSteps().length }})
      </button>
      <button
        (click)="setActiveTab('preview')"
        [class]="
          activeTab() === 'preview' ? 'bg-[#667eea] text-white' : 'bg-gray-200 text-gray-700'
        "
        class="px-4 py-2 rounded-lg font-semibold text-sm transition-colors hover:opacity-90"
      >
        ğŸ” PodglÄ…d kroku
      </button>
    </div>

    @if (activeTab() !== 'preview') {
      <input
        type="text"
        class="py-2 px-3 text-sm border-2 border-gray-300 rounded-lg w-80 focus:outline-none focus:border-[#667eea]"
        placeholder="Szukaj czÄ™Å›ci (np. 'Technic Brick' lub '118')..."
        [value]="searchFilter()"
        (input)="onSearchChange($event)"
      />
    }
  </div>

  <!-- ZawartoÅ›Ä‡ zakÅ‚adek -->
  @if (activeTab() === 'parts') {
    <app-parts-list
      [parts]="filteredParts()"
      [selectedPackages]="stepMappingService.selectedPackages()"
      (partClick)="onPartClick($event)"
    />
  } @else if (activeTab() === 'history') {
    <app-history [mappedSteps]="stepMappingService.mappedSteps()" />
  } @else if (activeTab() === 'preview') {
    <app-step-preview [mappedSteps]="stepMappingService.mappedSteps()" />
  }
</div>
